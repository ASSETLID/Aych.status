#!/bin/bash

trap 'echo you hit Ctrl-C/Ctrl-\, now exiting..; exit' SIGINT SIGQUIT

#################### Config Variables ########################
DEFAULTS=${DEFAULTS:-"/etc/default/ows"}

# Exit if the package is not installed
if [ -x "$DEFAULTS" ]; then
  echo "OWS not fully configured. Check $DEFAULTS"
  exit 0
fi

# Read configuration variable file if it is present
[ -r $DEFAULTS ] && . $DEFAULTS

######################################################################

${OWSUPDATE} -a

for i in `ls -d ${REPORTDIR}/$(/bin/date +%Y-%m-)*/*`; do
  if [ -d $i ]; then
    ${OWSRUN} --targetdir ${TARGETDIR} --baseurl ${BASEURL} --nosvg --nocache $i
  else
    echo "Empty $i"
  fi
done

${OWSARCHIVE} ${TARGETDIR}
